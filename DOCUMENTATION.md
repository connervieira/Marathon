# Documentation

This document stores information about Marathon, how to set it up, how it works, and how to use it!

Marathon is still very much a work in progress. This document will be filled out throughout the development of Marathon as features are developed and added.

## Setup

This section describes how to install Marathon on a technical level.

1. Install a web server.
    - Example: `sudo apt install apache2`
2. Install PHP.
    - Example: `sudo apt install php8.1`
3. Make sure the PHP module for your web server is enabled.
    - Example: `sudo a2enmod php8.1`
4. Restart the web server to ensure changes are applied.
    - Example: `sudo apache2ctl restart`
5. Download Marathon from wherever you received it from, and move it to you the root of your web server.
    - Example: `mv ~/Downloads/marathon /var/www/html/`
7. Determine where Marathon's databases will be stored.
    1. Open the `import\_databases.php` script in a text editor.
    2. At the top of the script, you'll see a variable titled `$database\_directory`.
    3. Set this variable to an absolute directory path, indicating where you want Marathon to store databases.
        - This directory should not be accessible through your web-server, in order to prevent clients from being able to access confidential information.
    4. Verify that the directory you specify is writable to Marathon.
8. If necessary, unblock HTTP traffic on your firewall.
    - Example: `sudo ufw allow 80; sudo ufw allow 443`
9. At this point, you should be able to load Marathon in your browser.
     - Example: `http://localhost/marathon/`


## Initial Configuration

This section describes how to initially configure Marathon after it has been set up.

1. Sign up for an admin account but visiting `/marathon/signup.php` on your Marathon instance.
    - Example: `http://localhost/marathon/signup.php`
2. After creating an admin account, navigate to the login page.
    - Example: `http://localhost/marathon/login.php`
    - Note: Make sure you open the Admin Login Page, not the Employee Login Page.
3. From the Main Admin Page, open the Configuration page.
    - Example: `http://localhost/marathon/configure.php`
4. Make sure 'Disable Admin Sign Ups' is checked.
    - Allow any managers or owners to sign up for an admin account before disabling admin sign-ups.
    - The 'Disable Admin Sign Ups' settings prevents new admin accounts from being generated. If this setting is turned off, anyone with access to your Marathon instance will be able to make an admin account and modify your configuration.
    - In the event that you ever lose your main admin account, this setting can be manually changed by someone with remote or physical access to the Marathon server by modifying it's value in the `configurationdatabase.json` database.
5. Set a 'Shift Verification Key'.
    - This value is the key that will be used to hash employee shift information to generate shift verification hash. This hash can only be generated by someone who has the shift verification key. This allows employees to prove that they've completed a particular shift by presenting their shift verification hash. The shift verification key should be kept private to prevent employees from generating fake shift verification hashes.
6. Enter the currency your business uses in the "Business Currency Symbol" field.
    - For example, you may enter `USD` if your business uses the US dollar to manage payments.
    - This setting doesn't have a significant effect on the underlying system of Marathon. It's simply a convenience setting that helps determine things like rounding. For example, if this value is set to 'USD', values will typically be rounded off to two decimal places.
7. Set the 'Max Shifts Displayed' value.
    - This setting determines how many shifts are displayed for each user in the admin dashboard before they are truncated in order to keep the interface organized.
    - If you regularly manage Marathon from a device with a larger display, it may be helpful to set this to a higher number (for example, 8) so that more shifts are displayed for each employee without needing to manually open an employee's entire shift log.
8. After you've configured the settings explained above, click 'Submit' to save configuration changes.


## Verify

This section describes how to verify that Marathon is functioning appropriately before continuing.

1. Verify that you've correctly setup and configured Marathon by using the 'Production Ready' tool.
    - This tool is located at /marathon/productionready.php
        - Example: `http://localhost/marathon/productionready.php`
    - This tool is designed to check common configuration mistakes before your Marathon instance is published. 
    - It should be noted that this tool is not infallible, but it should catch most issues.
2. Provided no issues are detected by the Production Ready tool, the initial setup process is complete. Positions, employees, and other information can now be added.


## Position Management

### Adding Positions

1. Sign into your admin account if you aren't already logged in.
2. Click through to the 'Positions' page.
3. On the Positions page, click 'Add/Edit Position'.
4. In the form that appears, fill out the position's information using the descriptions below.
    - **ID Number**
        - A unique number that identifies this position.
        - If left blank, a unique number will be randomly generated.
        - This value is also used to edit positions. See [Editing Positions](#editing-positions) for more information.
    - **Position Name**
        - This is the human-readable name of this position.
    - **Default Pay Amount**
        - This is the default amount that employees of this position will be paid per hour.
        - This will be overridden if an employee has a different pay amount set in their employee information.
    - **Can Clock In**
        - This determines whether or not employees of this position can clock in.
        - If an employee is paid full time and earns a fixed salary, you may want to disable this.
    - **Position Description**
        - A description and explanation of this position.
        - This value is fully optional and can be used to organize positions.


### Deleting Position

To delete a position, follow these steps.

1. Click the 'Delete' button below a position's information.
2. On the page that opens, click 'Confirm' to confirm that you're sure you'd like to delete this position.


### Editing Positions

If you'd like to update a position's information, you can do so by overwriting it with the edit function. To edit a position, simply click the "Edit" button below its information listed in the "View" section of the "Positions" page. This will automatically populate the position's information in the edit form.


## Employee Management

### Adding Employees

Marathon makes it easy to add employees to the database. To add an employee to Marathon, follow these steps.

1. Sign into your admin account.
2. Click through to the 'Employees' page.
3. On the Employees page, click 'Add/Edit Employee'.
4. In the form that appears, fill out the employee's information using the descriptions below.
    - **ID Number**
        - A unique number that identifies this employee.
        - If left blank, a unique number will be randomly generated.
        - This value is also used to edit employees. See [Editing Employees](#editing-employees) for more information.
    - **First Name** (required)
        - The first name of the employee.
    - **Middle Name**
        - The middle name of the employee.
    - **Last Name**
        - The last name of the employee.
    - **Position ID**
        - The ID of this employee's position in the company.
        - This ID should correspond to a position created in the "Positions" menu in Marathon.
    - **Hourly Pay**
        - This value determines how much the employee gets paid per hour.
        - This value will override the default pay of their position.
        - If this value is left blank, or is equal to 0, then the default hourly pay of this employee's position will be used to calculate shift pay.
    - **Gender**
        - The gender of the employee.
        - This value is a string and doesn't restrict you to any specific values. For sake of organization, you should try to be consistent with how you define employee genders.
    - **Birthday**
        - The employee's date of birth.
    - **Phone**
        - The employee's phone number.
    - **Email**
        - The employee's email address.
    - **Instant Message Contact**
        - The contact information for an employee on a given instant messaging server.
        - This value is simply a string, allowing you to put the contact information for really any service you want. For example, if your business uses Matrix to communicate with employees, you may put this employee's Matrix contact information here.
    - **Address**
        - This employee's home address.
    - **Social Security Number**
        - The social security number of the employee.
        - It is important to note that this value is stored in the database as an unencrypted value. For this reason, you may want to consider only storing the last 4 digits of each employee's social security number.
    - **Employee Password/PIN** (Required)
        - This is the password or PIN that this employee will use to sign into their account in order to clock in and perform other tasks.
    - **Tips**
        - This determines whether or not the employee is allowed to accept tips.
    - **Payment Information**:
        - This field is for the employee's payment information.
        - You can store any string here, including bank account information, cryptocurrency addresses, or other payment processor information.
        - Even if an employee is paid in cash, you should consider adding a note here to make it easier to pay out this employee's shifts later.


### Deleting Employees

To delete an employee, follow these steps.

1. Click the 'Delete' button below an employee's information.
2. On the page that opens, click 'Confirm' to confirm that you're sure you'd like to delete this employee.


### Editing Employees

If you'd like to update an employee's information, you can do so by clicking the "Edit" button below an employee's information. All of the employee's information will automatically populate the edit form, excluding their password. To leave the password unchanged, simply leave the password field blank.


## Verifying Shift Verification Hashes

To verify a shift verification hash, follow these instructions.
1. Log in to your admin account.
2. Click the 'Shifts' page.
3. Click 'Open' under the 'Verify Shift' tool.
4. Paste in the shift verification hash into the 'Hash' field.
5. Enter your shift verification key into the Key field.
    - If this field is left blank, the default key defined in the Marathon configuration will be used to decrypt the hash.
    - If you've changed your shift verification key since the hash was generated, you should manually enter the old key.
6. Press the 'Submit' button.
7. The hash provided will be decrypted using the key provided. The output will be shown below the form.
    - If you see random nonsensical characters, it's possible one of the values were mistyped, or the hash is invalid. However, it's also possible that the hash was encrypted using a different key. This could have happened if you've changed your shift verification key since this hash was created.
        - If you've changed your key since the shift was recorded, try using your old shift verification keys.
    - If the shift hash is valid, you should see the raw shift data in plain text.
