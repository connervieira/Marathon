# Documentation

This document stores information about Marathon, how to set it up, how it works, and how to use it!

Marathon is still very much a work in progress. This document will be filled out throughout the development of Marathon as features are developed and added.

## Setup

This section describes how to install Marathon on a technical level.

1. Install Apache if you haven't already.
    - `sudo apt install apache2`
2. Install PHP if you haven't already.
    - `sudo apt install php7.4`
3. If the PHP isn't automatically enabled, enable it.
    - `sudo a2enmod php7.4`
4. Restart Apache to ensure changes are applied appropriately.
    - `sudo apache2ctl restart`
5. Download Marathon, and copy it to you the root of your web server.
    - `mv ~/Downloads/marathon /var/www/html/`
6. Restart Apache.
    - Example: `sudo apache2ctl restart`
7. Determine where Marathon's databases will be stored.
    1. Open the `import\_databases.php` script in a text editor.
    2. At the top of the script, you'll see a variable titled `$database\_directory`.
    3. Set this variable to an absolute directory path, indicating where you want Marathon to store databases.
    4. Verify that the directory you specify is writable to Marathon.
8. Optionally, unblock Apache on your firewall.
    - `sudo ufw allow 80; sudo ufw allow 443`
9. At this point, you should be able to load Marathon by loading `http://localhost/marathon` in your browser.


## Initial Configuration

This section describes how to initially configure Marathon after it has been set up.

1. Sign up for an admin account but visiting `/marathon/signup.php` on your Marathon instance.
    - Example: `http://localhost/marathon/signup.php`
2. After creating an admin account, navigate to the login page.
    - Example: `http://localhost/marathon/login.php`
    - Note: Make sure you open the Admin Login Page, not the Employee Login Page.
3. From the Main Admin Page, open the Configuration page.
    - Example: `http://localhost/marathon/configure.php`
4. Make sure 'Disable Admin Sign Ups' is checked.
    - Allow any managers or owners to sign up for an admin account before disabling admin signups.
    - The 'Disable Admin Sign Ups' settings prevents new admin accounts from being generated. If this setting is turned off, anyone with access to your Marathon instance will be able to make an admin account and modify your configuration.
    - In the event that you ever lose your main admin account, this setting can be manually changed by someone with remote or physical access to the Marathon server by modifying it's value in `database/configurationdatabase.txt`.
5. Set a 'Clock In Verification Key'.
    - This value is the key that will be used to hash employee shift information to generate Shift Verification Hash. This hash can only be generated by someone who has the Clock In Verification Key. This allows employees to prove that they've completed a particular shift by presenting their Shift Verification Hash. This key should be kept private to prevent employees from generating fake Shift Verification Hashes.
6. Enter the currency your business uses in the "Business Currency Symbol" field.
    - For example, you may enter `USD` if your business uses the US dollar to manage payments.
    - This setting doesn't have a significant effect on the underlying system of Marathon. It's simply a conveinence setting that helps determine things like rounding. For example, if this value is set to 'USD', values will typically be rounded off to two decimal places.
7. After you've configured the settings explained above, click 'Submit' to save configuration changes.
8. Verify that you've correctly setup and configured Marathon by using the Production Ready tool.
    - This tool is located at /marathon/productionready.php
        - Example: `http://localhost/marathon/productionready.php`
    - This tool is designed to check common configuration mistakes before your Marathon instance is published. 
9. The base configuration of Marathon is now complete. You can now begin adding employees and positions to your Marathon instance.


## Position Management

### Adding Positions

1. Sign into your admin account if you aren't already logged in.
2. Click through to the 'Positions' page.
3. On the Positions page, click 'Add/Edit Position'.
4. In the form that appears, fill out the positions's information using the descriptions below.
    - **ID Number**
        - A unique number that identifies this position.
        - If left blank, a unique number will be randomly generated.
        - This value is also used to edit positions. See [Editing Positions](#editing-positions) for more information.
    - **Position Name**
        - This is the human-readable name of this position.
    - **Default Pay Amount**
        - This is the default amount that employees of this position will be paid per hour.
        - This will be over-ridden if an employee has a different pay amount set in their employee information.
    - **Can Clock In**
        - This determines whether or not employees of this position can clock in.
        - If an employee is paid full time and earns a fixed salary, you may want to disable this.
    - **Position Description**
        - A description and explanation of this position.
        - This value is fully optional and can be used to organize positions.


### Deleting Position

To delete a position, follow these steps.

1. Click the 'Delete' button below a position's information.
2. On the page that opens, click 'Confirm' to confirm that you're sure you'd like to delete this position.


### Editing Positions

If you'd like to update a position's information, you can do so by overwriting it with the edit function. To edit a position, simply enter its ID number in the 'ID Number' field, and re-enter its information, adjusting it where necessary. This will allow you to change a position's information without changing its ID number.


## Employee Management

### Adding Employees

Marathon makes it easy to add employees to the database. To add an employee to Marathon, follow these steps.

1. Sign into your admin account.
2. Click through to the 'Employees' page.
3. On the Employees page, click 'Add/Edit Employee'.
4. In the form that appears, fill out the employee's information using the descriptions below.
    - **ID Number**
        - A unique number that identifies this employee.
        - If left blank, a unique number will be randomly generated.
        - This value is also used to edit employees. See [Editing Employees](#editing-employees) for more information.
    - **First Name** (required)
        - The first name of the employee.
    - **Middle Name**
        - The middle name of the employee.
    - **Last Name**
        - The last name of the employee.
    - **Position ID**
        - The ID of this employee's position in the company.
        - This ID should correspond to a position created in the "Positions" menu in Marathon.
    - **Hourly Pay**
        - This value determines how much the employee gets paid per hour.
        - This value will override the default pay of their position.
        - If this value is left blank, or is equal to 0, then the default hourly pay of this employee's position will be used to calculate shift pay.
    - **Gender**
        - The gender of the employee.
        - This value is a string and doesn't restrict you to any specific values. For sake of organization, you should try to be consistent with how you define employee genders.
    - **Birthday**
        - The employee's date of birth.
    - **Phone**
        - The employee's phone number.
    - **Email**
        - The employee's email address.
    - **Instant Message Contact**
        - The contact information for an employee on a given instant messaging server.
        - This value is simply a string, allowing you to put the contact information for really any service you want. For exmaple, if your business uses Matrix to communicate with employees, you may put this employee's Matrix contact information here.
    - **Address**
        - This employee's home address.
    - **Social Security Number**
        - The social security number of the employee.
        - It is important to note that this value is stored in the database as an unencrypted value. For this reason, you may want to consider only storing the last 4 digits of each employee's social security number.
    - **Employee Password/PIN** (Required)
        - This is the password or PIN that this employee will use to sign into their account in order to clock in and perform other tasks.
    - **Tips**
        - This determines whether or not the employee is allowed to accept tips.
    - **Payment Information**:
        - This field is for the employee's payment information.
        - You can store any string here, including bank account information, cryptocurrency addresses, or other payment processor information.


### Deleting Employees

To delete an employee, follow these steps.

1. Click the 'Delete' button below an employee's information.
2. On the page that opens, click 'Confirm' to confirm that you're sure you'd like to delete this employee.


### Editing Employees

If you'd like to update an employee's information, you can do so by overwriting them with the edit function. To edit an employee, simply enter their ID number in the 'ID Number' field, and re-enter their information, adjusting it where necessary. This will allow you to change an employee's information without changing their ID number.


## Verifying Shift Verification Hashes

To verify a Shift Verification Hash, follow these instructions.
1. Log in to your admin account.
2. Click through to the 'Tools' page.
3. Click 'Open' under the 'Verify Shift' tool.
4. Paste in the Shift Verification Hash into the Hash field.
5. Click 'Submit'.
6. Enter your Shift Verification Key into the Key field.
    - If this field is left blank, the default key defined in the Marathon configuration will be used to decrypt the hash.
7. Press 'Submit'
8. The hash provided will be decrypted using the key provided. The output will be shown below the form.
    - If you see random nonsensical characters, its possible one of the values were mistyped, or the hash is invalid. However, it's also possible that the hash was encrypted using a different key. This could have happened if you've changed your Clock In Verification key since this hash was created.
    - If the shift hash is valid, you should see the raw shift data in plain text.
